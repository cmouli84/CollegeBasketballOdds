<html ng-app="App">
<head>
  <meta charset="utf-8">
  <title>College Basket Ball Odds</title>
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://bootswatch.com/cosmo/bootstrap.min.css" />
  <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.2/angular.js"></script>
  <script type="text/javascript">
    var App = angular.module('App', []);

    App.controller('NbacbCtrl', function($scope, $http, $filter) {
      $http.get('/api/nbacb')
           .then(function(res){
              $scope.picks = res.data;                
            });
      
      $scope.eventDates = [];
      
      for (var i=0; i<21; i++) {
          var eventDate = new Date();
          eventDate.setDate(eventDate.getDate() - 10 + i);
    	  $scope.eventDates.push({
    		  date: eventDate,
    		  selected: (i === 10)
    	  });
   	  }
      
      $scope.getWestGatePointSpread = function(westGatePointSpread) {
    	  return (westGatePointSpread === -999999) ? "Not Available" : westGatePointSpread;
      }
      
      $scope.getSonnyMoorePowerRanking  = function(pick) {
    	  return ((pick.homeTeamSonnyMoorePowerRanking === -999999 || pick.awayTeamSonnyMoorePowerRanking === -999999) 
    	  		? "N/A" 
    	  		: Math.round((pick.awayTeamSonnyMoorePowerRanking - pick.homeTeamSonnyMoorePowerRanking) * 100.0)/100.0)
    	  		+ " ("
    	  		+ (pick.awayTeamSonnyMoorePowerRanking === -999999 ? "N/A" : pick.awayTeamSonnyMoorePowerRanking)
    	  		+ " - "
    	  		+ (pick.homeTeamSonnyMoorePowerRanking === -999999 ? "N/A" : pick.homeTeamSonnyMoorePowerRanking)
    	  		+ ")";
      }
      
      $scope.getGameScore = function(pick) {
    	  return (pick.homeScore === -999999) ? "Not Started" : pick.homeScore + "-" + pick.awayScore;
      }
      
      $scope.getSonnyMooreOdds = function(pick) {
    	  return (pick.sonnyMoorePointSpread === -999999) ? "Not Available" : pick.sonnyMoorePointSpread;
      }

      $scope.getSonnyMooreStatusClass = function(pick) {
    	  if (pick.sonnyMoorePointSpread === -999999 || pick.westgateCurrentPointSpread === -999999)
   		  {
    		  return "";
   		  }
    	  
    	  var dtCurrentDate = new Date();
    	  var dtGameDate = new Date(pick.gameDate);
    	  dtGameDate.setFullYear((dtGameDate.getMonth()>6 && dtCurrentDate.getMonth()>6) || (dtGameDate.getMonth()<=6 && dtCurrentDate.getMonth()<=6) 
    			  ? dtCurrentDate.getFullYear() : dtCurrentDate.getFullYear() - 1 );
    	  dtGameDate.setHours(dtGameDate.getHours() + 3);
    	  if (dtGameDate < dtCurrentDate)
   		  {
    		  if ((((pick.awayScore - pick.homeScore) > pick.westgateCurrentPointSpread) && (pick.sonnyMoorePointSpread > pick.westgateCurrentPointSpread)) 
    				  || (((pick.awayScore - pick.homeScore) < pick.westgateCurrentPointSpread) && (pick.sonnyMoorePointSpread < pick.westgateCurrentPointSpread))) 
   			  {
   			  		return "success";
   			  }
			  return "danger";
   		  }
    	  
    	  return "";
      }

      $scope.loadMatchesByDate = function(event) {
          $http.get('/api/nbacb/' + $filter('date')(event.date, "yyyy-MM-dd"))
          .then(function(res){
             $scope.picks = res.data;
             
             angular.forEach($scope.eventDates, function(value, key) {
            	  value.selected = (value.date == event.date);
            	});
           });
      }
      
    });

  </script>
  <style type="text/css">
.wrapper {
  position:relative;
  margin:0 auto;
  overflow:hidden;
  padding:5px;
  height:68px;
}

.list {
  position:absolute;
  left:0px;
  top:0px;
  min-width:3000px;
  margin-left:12px;
  margin-top:0px;
}

.list li{
  display:table-cell;
  position:relative;
  text-align:center;
  cursor:grab;
  cursor:-webkit-grab;
  color:#efefef;
  vertical-align:middle;
}
.nav>li>a {
  padding-top: 3px;
  padding-bottom: 6px;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}
.scroller {
  text-align:center;
  cursor:pointer;
  display:none;
  padding:7px;
  padding-top:11px;
  white-space:no-wrap;
  vertical-align:middle;
  background-color:#fff;
}

.scroller-right{
  float:right;
}

.scroller-left {
  float:left;
}
  </style>
</head>
<body>
  <div class="container" ng-controller="NbacbCtrl">  
    <div>
      <div class="scroller scroller-left"><i class="glyphicon glyphicon-chevron-left"></i></div>
      <div class="scroller scroller-right"><i class="glyphicon glyphicon-chevron-right"></i></div>
      <div class="wrapper">
        <ul class="nav nav-tabs list" id="myTab" >
          <li ng-class="{'active' : event.selected}" ng-repeat="event in eventDates">
            <a href="#" class="text-uppercase" ng-click="loadMatchesByDate(event)"><div style="font-size: 25px">{{event.date | date:'dd'}}</div>{{event.date | date:'MMM'}}</a>
          </li>
      </ul>
      </div>
    </div>
    <div>
      <table class="table table-striped col-lg-6 col-md-6 col-sm-9 col-xs-12">
        <thead>
          <tr>
            <th class="col-lg-4 col-md-4 col-sm-4 col-xs-4">Match</th>
            <th class="col-lg-2 col-md-2 col-sm-2 col-xs-2">Westgate Odds</th>
            <th class="col-lg-2 col-md-2 col-sm-2 col-xs-2">Sonny Moore Odds</th>
            <th class="col-lg-2 col-md-2 col-sm-2 col-xs-2">Rating Diff (A-H)</th>
            <th class="col-lg-2 col-md-2 col-sm-2 col-xs-2">Score (Home-Away)</th>
          </tr>
        </thead>
        <tr ng-class="getSonnyMooreStatusClass(pick)" ng-repeat="pick in picks">
          <td class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
          	<div class="small">{{pick.gameDate}}</div>
          	<div>
            	<strong>{{pick.awayTeamName}} </strong>
            	<small>({{pick.awayWins}}-{{pick.awayLoses}})</small>
          	</div>
          	<div>
            	<strong>@{{pick.homeTeamName}} </strong> 
            	<small>({{pick.homeWins}}-{{pick.homeLoses}})</small>
          	</div>
          </td>
          <td class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="vertical-align:middle">{{getWestGatePointSpread(pick.westgateCurrentPointSpread)}}</td>
          <td class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="vertical-align:middle">{{getSonnyMooreOdds(pick)}}</td>
          <td class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="vertical-align:middle">{{getSonnyMoorePowerRanking(pick)}}</td>
          <td class="col-lg-2 col-md-2 col-sm-2 col-xs-2" style="vertical-align:middle">{{getGameScore(pick)}}</td>
        </tr>
      </table>
    </div> 
  </div>
  <script type='text/javascript'>
        
    $(document).ready(function() {
      var hidWidth;
      var scrollBarWidths = 40;
      var widthOfList = function(){
        var itemsWidth = 0;
        $('.list li').each(function(){
          var itemWidth = $(this).outerWidth();
          itemsWidth+=itemWidth;
        });
        return itemsWidth;
      };

      var widthOfHidden = function(){
        return (($('.wrapper').outerWidth())-widthOfList()-getLeftPosi())-scrollBarWidths;
      };

      var getLeftPosi = function(){
        return $('.list').position().left;
      };

      var reAdjust = function(){
        if (($('.wrapper').outerWidth()) < widthOfList()) {
        $('.scroller-right').show();
      }
      else {
        $('.scroller-right').hide();
      }
  
      if (getLeftPosi()<0) {
        $('.scroller-left').show();
      }
      else {
        $('.item').animate({left:"-="+getLeftPosi()+"px"},'slow');
        $('.scroller-left').hide();
      }
    }

    reAdjust();

    $(window).on('resize',function(e){  
      reAdjust();
    });

    $('.scroller-right').click(function() {
      $('.scroller-left').fadeIn('slow');
      $('.scroller-right').fadeOut('slow');
  
      $('.list').animate({left:"+="+widthOfHidden()+"px"},'slow',function(){
      });
    });

    $('.scroller-left').click(function() {
	  $('.scroller-right').fadeIn('slow');
      $('.scroller-left').fadeOut('slow');
  
      $('.list').animate({left:"-="+getLeftPosi()+"px"},'slow',function(){
  	  });
    });
  });
  </script>
</body>
</html>